@namespace(uri="http://tura.org/2013/v1/domain", prefix="tura.domain")
@gmf
package domain;

@gmf.diagram.domain
class Domain{
  id attr EString uid;
  val DomainArtifacts[1]#parent domainArtifacts;
  val DomainTypes[1]#parent domainTypes;
  val DomainApplications[1]#parent domainApplications;
}

@gmf.node(label="name")
class DomainArtifacts{
    id attr EString uid;
    attr EString name;  
   ref Domain#domainArtifacts parent;
   @gmf.compartment
   val DomainArtifact[*]#parent domainArtifact;
}

@gmf.node(label="name")
class DomainTypes{
    id attr EString uid;
   attr EString name;  
   ref TypesRepository#parent typesrepository;
   ref Domain#domainTypes parent;
}

@gmf.node(label="name")
class DomainApplications{
    id attr EString uid;
   attr EString name;  
   @gmf.compartment
   val DomainApplication[*]#parent applications;
   ref Domain#domainApplications parent;
}

@gmf.node(label="name")
class DomainApplication{
   id attr EString uid;
   attr EString name;  
   ref Application#parent application;
   ref DomainApplications#applications parent;
}


@gmf.node(label="name")
class DomainArtifact{
    id attr EString uid;
   attr EString name;
   ref DomainArtifacts#domainArtifact parent;
   ref  Artifacts#parent artifact;
}


@gmf.node(label="name")
class ORMEntity extends DomainArtifact{
}

@gmf.node(label="name")
class JPAService extends DomainArtifact{
}

@gmf.node(label="name")
class EJBService extends DomainArtifact{
}

@gmf.diagram.artifact
class Artifacts{
    id attr EString uid;
   val Artifact[*]#parent artifacts;
   ref DomainArtifact#artifact parent;
}

@gmf.node(label="name")
class Artifact{
    id attr EString uid;
   attr EString name;
   attr EString description;
   ref Artifacts#artifacts parent;
   
   // Variables resolved by configuration of recipe (for example server IP)  
   @gmf.compartment
   val   ConfigVariable[*]#parent configVariables;
   
   // Variables to query model ( for example FormName or service name)
   @gmf.compartment
   val   Variable[*]#parent modelQuery;
   
   //For navigation in the template (for example choosing specific technologies EclipseLink vs Hibernate)
   @gmf.compartment
   val   Specifier[*]#parent specifiers;

   attr EString template;
}


@gmf.node(label="name")
class ConfigVariable{
   id attr EString uid;
  attr EString name;
   ref Artifact#configVariables parent;
}

@gmf.node(label="name")
class Variable{
    id attr EString uid;
   attr EString name;
   ref Artifact#modelQuery parent;
}


@gmf.node(label="name")
class Specifier{
    id attr EString uid;
   attr EString name;
   ref Artifact#specifiers parent;
   val  Option[1..*]#parent options;  
}

@gmf.node(label="name")
class Option{
    id attr EString uid;
   ref Specifier#options parent;
   attr EString value;
}

@gmf.diagram
class Application{
    id attr EString uid;
   val ApplicationRecipes#parent applicationRecipes;
   val ApplicationMappers#parent applicationMappers;
   ref DomainApplication#application parent;
}

@gmf.node(label="name")
class ApplicationRecipes{
    id attr EString uid;
   attr EString name;
   ref Application#applicationRecipes parent;
   @gmf.compartment
   val ApplicationRecipe[*]#parent recipes;
}

@gmf.node(label="name")
class ApplicationRecipe{
    id attr EString uid;
   attr EString name;
   ref Recipes#parent recipes;
   ref ApplicationRecipes#recipes parent;
}

@gmf.node(label="name")
class ApplicationMappers{
    id attr EString uid;
   attr EString name;
   ref Application#applicationMappers parent;
    @gmf.compartment
   val ApplicationMapper[*]#parent mappers;
}

@gmf.node(label="name")
class ApplicationMapper{
    id attr EString uid;
   attr EString name;
   ref Mappers#parent mapper; 
   ref ApplicationMappers#mappers parent;
}

@gmf.diagram.businessObjects
class BusinessObjects{
    id attr EString uid;
   val BusinessObject[*]#parent businessObject;
   ref BusinessPackage#businessobjects parent;
}

@gmf.node(label="name")
class BusinessObject {
    id attr EString uid;
   attr EString name;
   ref BusinessObjects#businessObject parent;
   @gmf.compartment()
   val CreateMethod[*]#parent createMethods;
   @gmf.compartment()
   val InsertMethod[*]#parent insertMethods;
   @gmf.compartment()
   val UpdateMethod[*]#parent updateMethods;
   @gmf.compartment()
   val RemoveMethod[*]#parent removeMethods;
   @gmf.compartment()
   val SearchMethod[*]#parent searchMethods;
   @gmf.compartment()
   val OtherMethod[*]#parent  othersMethods;
   
}

class BusinessMethod extends TypePointer {
    id attr EString uid;
   attr EString method;
}

@gmf.node(label="method")
class CreateMethod extends BusinessMethod{
   ref BusinessObject#createMethods parent;
}

@gmf.node(label="method")
class InsertMethod extends BusinessMethod{
   ref BusinessObject#insertMethods parent;
}

@gmf.node(label="method")
class UpdateMethod extends BusinessMethod{
   ref BusinessObject#updateMethods parent;
   
}

@gmf.node(label="method")
class RemoveMethod extends BusinessMethod{
   ref BusinessObject#removeMethods parent;
}

@gmf.node(label="method")
class SearchMethod extends BusinessMethod{
   ref BusinessObject#searchMethods parent;
}

@gmf.node(label="method")
class OtherMethod extends BusinessMethod{
   ref BusinessObject#othersMethods parent;
}


@gmf.diagram.mapper
class Mappers{
    id attr EString uid;
   val Mapper[*]#parent mappers;
   ref ApplicationMapper#mapper parent;
}

class Mapper extends TypePointer{
    id attr EString uid;
    ref Mappers#mappers  parent;
    attr boolean serviceLayer;
    attr boolean uiLayer;
}

@gmf.node(label="uid")
class JavaMapper extends Mapper{
   attr EString mappedToPackageName;
   attr EString mappedToClassName;
   attr EString artifactId;
   attr EString groupId;
   attr EString version;
   attr EString libraryName;
}


@gmf.diagram.recipe
class Recipes{
    id attr EString uid;
  val Recipe#parent recipe;
  val Configuration[*] configurations;
  val Infrastructure[*] infrastructures;
  ref ApplicationRecipe#recipes parent;
}

class UsingMappers{
  attr EString[*] mappers;
}

enum PlatformLayers{
   ServiceLayer = 0;
   UILayer = 1;
}

@gmf.node(label="name")
class Recipe extends UsingMappers{
    id attr EString uid;
  ref Recipes#recipe parent;
  attr EString name;
  @gmf.compartment
  val Ingredient[*]#parent ingredients;
  @gmf.link(target.decoration="arrow", style="dash")
  ref Infrastructure[*]#recipe infrastructures;
}

@gmf.node(label="name")
class Ingredient extends UsingMappers{
  id attr EString uid;
  attr EString name;
  ref Recipe#ingredients parent;
  @gmf.compartment
  val Component[*] components;
  attr PlatformLayers layer;
}

class Component{
    id attr EString uid;
   attr EString name;
     @gmf.compartment
  val Component[*]#parent components;
  @gmf.compartment(layout="list")
   val ModelMapper[*]#parent mappers;
   attr EString buildScript;
   attr EString deployScript;
}

@gmf.node(label="name")
class JavaComponent extends Component{
   attr EString artifactId;
   attr EString groupId;
   attr EString version;
   attr EString basePackage;   
}


@gmf.node(label="name")
class Infrastructure{
  id attr EString uid;
  ref Recipe#infrastructures recipe;
  attr EString name;
  @gmf.link(target.decoration="arrow", style="dash")
  ref Configuration#infrastructure recipeConfig;
}

@gmf.node(label="name")
class Configuration{
    id attr EString uid;
   attr EString name;
   ref Infrastructure#recipeConfig infrastructure;
   @gmf.compartment(layout="list")
   val Property[*] properties; 
  @gmf.link(style="dot", width="2" ,target.decoration="closedarrow")
   ref Configuration#parent configExtension;
   ref Configuration#configExtension parent;
}

@gmf.node(label="name")
class ModelMapper extends ArtifactRef{
   attr EString name;
   ref Component#mappers parent;
   val MappingSpecifier[*] specifiers;
   val MappingVariable[*] variables;
}

@gmf.node(label="name")
class Property{
    id attr EString uid;
   attr EString name;
   attr EString value;
}

class MappingSpecifier{
    id attr EString uid;
   attr EString name;
   attr EString value;
}
class MappingVariable{
    id attr EString uid;
   attr EString name;
   attr EString value;
}

class ArtifactRef{
    id attr EString uid;
   attr EString domainArtifact;
   attr EString artifactName;
}

class TypePointer{
  ref Package packageRef;
  ref TypeElement typeRef;
  
}

@gmf.diagram.typedefinition
class TypeDefinition{
    id attr EString uid;
   val TypeElement[*]#parent types;
   ref Package#typedefinition parent;
}

class TypeElement{
   attr EString name; 
   ref TypeDefinition#types parent;
}


@gmf.node(label="name")
class Primitive extends TypeElement{
    id attr EString uid;
}


@gmf.node(label="name")
class Type extends TypeElement {
    id attr EString uid;
   @gmf.compartment
   val Attribute[*]#parent attributes;
   @gmf.compartment
   val Operation[*]#parent operations;
   val TypeExtension[0..1] extension;
}

@gmf.node(label="uid")
class TypeReference extends TypeElement , TypePointer{
    id attr EString uid;
 }

@gmf.link(source="source", target="target", style="dot", width="2" ,target.decoration="closedarrow")
class TypeExtension {
    id attr EString uid;
    ref TypeElement source;
    ref TypeElement target;
}

@gmf.node(label="name")
class Attribute extends  TypePointer{
    id attr EString uid;
   attr EString name;
   attr EBoolean pk;
   ref Type#attributes parent;
}


@gmf.node(label="name")
class Operation{
    id attr EString uid;
   attr EString name;
   ref Type#operations parent;
   @gmf.compartment
   val Parameter[*]#parent parameters;
   @gmf.compartment
   val ReturnValue[0..1] returnValue;
}

@gmf.node(label="name")
class Parameter extends  TypePointer{
    id attr EString uid;
   attr EString name;
   ref Operation#parameters parent;
}


@gmf.node(label="uid")
class ReturnValue extends TypePointer{
    id attr EString uid;
}

@gmf.node(label="name")
class Enumarator extends TypeElement{
    id attr EString uid;
  @gmf.compartment
   val EnumAttribute[*]#parent values;
}

@gmf.node(label="name")
class EnumAttribute{
    id attr EString uid;
   ref Enumarator#values parent;
   attr EString name;
   attr EString  value;
}


@gmf.diagram.typesrepository
class TypesRepository{
    id attr EString uid;
  val Types[1]#parent typeDefinition;
  ref DomainTypes#typesrepository parent;
}

@gmf.node(label="name")
class Types {
    id attr EString uid;
   ref TypesRepository#typeDefinition parent;
   attr EString name;
   @gmf.compartment
   val Package[*]#parent packages;
   @gmf.compartment
   val BusinessPackage[*]#parent businessPackages;
   
}

@gmf.node(label="name")
class Package{
    id attr EString uid;
   attr EString name;
   ref TypeDefinition#parent typedefinition;
   ref  Types#packages parent;
}


@gmf.node(label="name")
class BusinessPackage{
    id attr EString uid;
   attr EString name;
   ref BusinessObjects#parent businessobjects;
   ref  Types#businessPackages parent;
}
