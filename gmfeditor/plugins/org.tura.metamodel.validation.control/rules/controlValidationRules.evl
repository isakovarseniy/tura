context domain::ArtificialField{

  constraint HasName {

      check :  self.name.isDefined()

      message : 'Unnamed ' + self.eClass().name + ' not allowed'

  }
   constraint UniqueName{

      guard : self.satisfies("HasName")
      check : self.parent.artificialFields.select(r|r.isKindOf(domain::ArtificialField) and r.name=self.name).size() = 1
      message : 'Artificial name  ' + self.name + ' is not unique'
   
   } 

}

context domain::Relation{
     constraint HasDependency{
       check: self.dependencies.select(r|r.master = self.master and r.detail = self.detail).size() = 0
       message : 'Relation and Dependency cannot resides between same data controls'
     }
}

context domain::FormVariable{

  constraint HasName {

      check :  self.name.isDefined()

      message : 'Unnamed ' + self.eClass().name + ' not allowed'

  }
   constraint UniqueName{

      guard : self.satisfies("HasName")
      check : self.eContainer().variables.select(r|r.isKindOf(FormVariable) and r.name=self.name).size() = 1
      message : 'FormVariable name  ' + self.name + ' is not unique'
   
   } 

   constraint CheckParameterType{

      guard : self.satisfies("UniqueName") and self.paramRef.isDefined() and self.paramRef.typeRef.isDefined() and self.typeRef.isDefined()
      check : self.paramRef.typeRef.uid = self. typeRef.uid
      message : 'FormVariable ' + self.name + ' has different type then '+self.paramRef.name
   
   } 

}


 context domain::DataControl {

  constraint HasName {

      check :  self.name.isDefined()

      message : 'Unnamed ' + self.eClass().name + ' not allowed'

  }

   constraint UniqueName{

      guard : self.satisfies("HasName")
      check : self.parent.controls.select(r|r.isKindOf(DataControl) and r.name=self.name).size() = 1
      message : 'Data control name  ' + self.name + ' is not unique'
   
   } 

  constraint HasCreateMethod {

      check :  self.create.isDefined()

      message : 'Create Method for ' + self.name + ' is not defined'

  }

  constraint HasInsertMethod {

      check :  self.insert.isDefined()

      message : 'Insert Method for ' + self.name + ' is not defined'

  }

 constraint HasUpdatetMethod {

      check :  self.update.isDefined()

      message : 'Update Method for ' + self.name + ' is not defined'

  }

 constraint HasRemoveMethod {

      check :  self.remove.isDefined()

      message : 'Remove Method for ' + self.name + ' is not defined'

  }

 constraint HasSearchMethod {

      check :  self.search.isDefined()

      message : 'Search Method for ' + self.name + ' is not defined'

  }


 constraint BaseType {

      check :  self.baseType <> null  and self.baseType.typeRef <> null

      message : 'Basetype for ' + self.name + ' is not defined'

  }

}
